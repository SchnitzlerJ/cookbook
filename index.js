var g_Recipes = [
	{
		"name": "Hefeteig (süß)",
		"persons": undefined,
		"ingredients": [
			{ "amount": "500 g", "name": "Mehl" },
			{ "amount": "250 ml", "name": "Milch"},
			{ "amount": "20 g", "name": "Hefe" },
			{ "amount": "60-80 g", "name": "Zucker" },
			{ "amount": "80-100 g", "name": "Butter" },
			{ "amount": "1-2", "name": "Eier"}
		],
		"steps": [
			"$1, $3 und $4 mischen und erwärmen.",
			"$0 in Schüssel geben und eine Kuhle formen.",
			"Die Mischung aus $1, $3 und $4 zusammen mit $2 in die Kuhle geben und vermischen.",
			"Gehen lassen bis sich Bläschen bilden.",
			"$5 hinzugeben, gut durchkneten und auf doppelte Höhe gehen lassen.",
		],
		"inspiration": "Kochen und Backen nach Grundrezepten (Luise Haarer)",
	},
	{
		"name": "Kartoffelcremesuppe",
		"persons": undefined,
		"ingredients": [
			{ "amount": "400 g", "name": "Kartoffeln" },
			{ "amount": "2 EL", "name": "Olivenöl" },
			{ "amount": "2 Zehen", "name": "Knoblauch" },
			{ "amount": "800 ml", "name": "Gemüsebrühe" },
			{ "amount": "150 g", "name": "Crème fraîche" },
		],
		"steps": [
			"$0 schälen und würfeln.",
			"$2 fein hacken und zusammen mit $0 in $1 andünsten.",
			"$3 dazugießen und aufkochen. 10 Minuten kochenlassen.",
			"Die gegarte Suppe fein pürieren, $4 unterschlagen.",
		],
		"inspiration": "TODO",
	},
	{
		"name": "Linsen mit Spätzle",
		"persons": 4,
		"ingredients": [
			{ "amount": "620 g", "name": "Mehl" },
			{ "amount": "6", "name": "Eier" },
			{ "amount": "2 kleine Gläser", "name": "Linsen" },
			{ "amount": "5 kleine Gläser", "name": "Wasser" },
			{ "amount": "1", "name": "große Zwiebel" },
			{ "amount": "2", "name": "Karotten" },
			{ "amount": "2.4 TL", "name": "Salz" },
			{ "amount": "3", "name": "Lorbeerblätter"},
		],
		"steps": [
			"$4 und $5 klein würfeln und mit Butter andünsten.",
			"$2, $3 und $7 hinzugeben und Deckel schließen. Kochen.",
			"$0, $6 und $1 zu einem Teig schlagen.",
			"Spätzle machen.",
			"Linsen mit Essig, Salz und Pfeffer abschmecken.",
		],
		"inspiration": null,
	},
	{
		"name": "Chili sin carne (Sojahack)",
		"persons": 3,
		"ingredients": [
			{ "amount": "800 g", "name": "Dosentomaten" },
			{ "amount": "800 g", "name": "Kidneybohnen" },
			{ "amount": "170 ml", "name": "Sojagranulat" },
			{ "amount": "340 ml", "name": "Wasser (kochend)" },
			{ "amount": "", "name": "Gemüsebrühe" },
			{ "amount": "1 Zehe", "name": "Knoblauch" },
			{ "amount": "1", "name": "Zwiebel" },
			{ "amount": "3", "name": "Paprika" },
			{ "amount": "", "name": "Chilis" },
			{ "amount": "", "name": "Kreuzkümmel"},
			{ "amount": "", "name": "Schokolade (74%)"},
			{ "amount": "", "name": "Kakaopulver"},
			{ "amount": "", "name": "Paprikapulver"},
			{ "amount": "", "name": "Zimt"},
			{ "amount": "", "name": "Oregano"},
			{ "amount": "", "name": "Salz"},
			{ "amount": "", "name": "Pfeffer"},
		],
		"steps": [
			"$2 in $3 mit etwas $4 einweichen.",
			"$7 und $6 würfeln.",
			"$2 abtropfen und im Topf scharf anbraten, mit Pfeffer und Salz würzen.",
			"$7 und $6 hinzugeben.",
			"$0, $1, $8 hinzugeben und köcheln lassen.",
			"$5 pressen und dazugeben, köcheln lassen und mit $9, $10, $11, $12, $13, $14, $15 und $16 abschmecken."
		],
		"inspiration": null,
	},
	{
		"name": "Kartoffelsalat",
		"persons": undefined,
		"ingredients": [
			{ "amount": "800 g", "name": "Salatkartoffeln" },
			{ "amount": "250 ml", "name": "Gemüsebrühe" },
			{ "amount": "5 EL", "name": "Essig" },
			{ "amount": "1.5 TL", "name": "Senf" },
			{ "amount": "2", "name": "Zwiebeln"},
			{ "amount": "3", "name": "Öl"},
		],
		"steps": [
			"$0 waschen, gar dämpfen und mit kaltem Wasser abschrecken.",
			"$4 fein würfeln und mit $1, $2 und $3 aufkochen.",
			"Warme Kartoffeln schälen und in dünne Scheiben schneiden,",
			"Brühe über die Kartoffeln geben, vorsichtig unterheben und ziehen lassen.",
			"$5 unterheben.",
			"Nach 30 Minuten mit Essig, Öl und Pfeffer abschmecken.",
		],
		"inspiration": "OptimusShepard",
	},
	{
		"name": "Brownies",
		"persons": "Blech 24 cm × 24 cm",
		"ingredients": [
			{ "amount": "130 g", "name": "Butter" },
			{ "amount": "270 g", "name": "Zartbitterschokolade" },
			{ "amount": "50 g", "name": "Muscovadozucker" },
			{ "amount": "90 g", "name": "Zucker" },
			{ "amount": "60 g", "name": "Mehl" },
			{ "amount": "40 g", "name": "Kakao" },
			{ "amount": "3", "name": "Eier" },
			{ "amount": "0.75 TL", "name": "Backpulver" },
		],
		"steps": [
			"$1 mit $0 schmelzen.",
			"$2 und $3 darunterschlagen und abkühlen lassen.",
			"Backofen auf 175 °C Ober-/Unterhitze vorwärmen und Backform einfetten.",
			"In weiterer Schüssel $4 mit $5 und $7 mischen.",
			"$6 in Schokolade-Butter-Zucker-Mischung rühren und kurz schaumig schlagen.",
			"Mehl-Kakao-Mischung unterheben, bis gerade so ein Teig entsteht. Nicht länger!",
			"In Backform verteilen und 15–22 Minuten im Ofen backen. Die Brownies sind fertig, wenn beim reinstechen nur wenig kleben bleibt und es sich beim Wackeln am Blech relativ fest verhält.",
			"Mindestens 6 Stunden kühl stellen.",
		],
		"inspiration": null,
	},
	{
		"name": "Bisquitrolle",
		"persons": "1 Blech",
		"ingredients": [
			{ "amount": "150 g", "name": "Mehl" },
			{ "amount": "150 g", "name": "Zucker" },
			{ "amount": "3", "name": "Eier" },
			{ "amount": "3 EL", "name": "warmes Wasser" },
			{ "amount": "3 TL", "name": "Backpulver" },
			{ "amount": "", "name": "Sahne" },
			{ "amount": "", "name": "Beeren" },
			{ "amount": "", "name": "Puderzucker" },
		],
		"steps": [
			"$2 trennen. Eiklar steif schlagen, danach die Hälfte des $1s einrieseln lassen.",
			"Eigelb in anderer Schüssel cremig schlagen.",
			"$3 hinzufügen, danach Rest des $1s unterschlagen.",
			"Eischnee darübergeben. $0 mit $4 mischen und auch in die Schüssel geben. Danach vorsichtig durchmischen.",
			"Masse in ein mit gefettetem Backpapier ausgelegtem Blech geben, glatt streichen und 12–13 Minuten bei 190–210 °C ohne Umluft backen bis der Teig anfängt leicht hellbraun zu werden.",
			"Sauberes Tuch auslegen und mit Zucker bestreuen.",
			"Sobald der Bisquit aus dem Ofen ist, auf das Tuch stürzen, Backpapier abziehen und den Bisquit zusammen mit dem Tuch aufrollen.",
			"Sobald die Rolle abgekühlt ist, entrollen, mit geschlagener $5 und $6 füllen, zusammenrollen und mit $7 bestreuen.",
		],
		"inspiration": "Kochen und Backen nach Grundrezepten (Luise Haarer)",
	},


];

var g_SimpleStyle = true;
let g_SelectedRecipeId = (new URL(window.location.href)).searchParams.get("recipe");
// TODO: Better catch all invalid values
if (g_SelectedRecipeId == "")
	g_SelectedRecipeId = null;


function constructRow(amount, ingred, step)
{
	if (amount == "" && ingred == "" && step == "")
		return "";
	return "<tr><td>" + amount + "</td><td>" + ingred + "</td><td>" + step + "</td></tr>";
}

function constructRecipe()
{
	let selectedRecipe = g_SelectedRecipeId != null && g_Recipes[g_SelectedRecipeId];

	let compSt = "";
	let simpSt = "";
	let includedIngredients = [];
	let s = 0;
	for (let step of selectedRecipe.steps)
	{
		compSt += constructRow("", "", "<b>" + ++s + ". ");
		let arr = step.split(/(\$[0-9]+)/gi);
		let i = 0;

		let amountStr = "";
		let ingredStr = "";
		let stepStr = "";

		for (let part of arr)
		{
			if (part[0] == "$")
			{
				let ing = part.substring(1);
				if (!includedIngredients.some(a => a == ing))
				{
					compSt += constructRow(amountStr, ingredStr, stepStr);
					includedIngredients.push(ing);
					stepStr = "";
					amountStr = selectedRecipe.ingredients[ing].amount;
					ingredStr = selectedRecipe.ingredients[ing].name;
				}
				else
					stepStr += selectedRecipe.ingredients[ing].name;
			}
			else
				stepStr += part;
		}
		compSt += constructRow(amountStr, ingredStr, stepStr);
		simpSt += "<li>" + step.replace(/\$[0-9]+/gi, (m) => selectedRecipe.ingredients[m.substring(1)].name) + "</li>";
	}
	document.getElementById("heading").innerHTML = selectedRecipe.name;

	document.getElementById("ingredients").innerHTML = includedIngredients.map(i =>
		"<tr><td>" + selectedRecipe.ingredients[i].amount + "</td><td>" + selectedRecipe.ingredients[i].name + "</td></tr>"
	).join("");
	document.getElementById("steps").innerHTML = simpSt;

	document.getElementById("complexStyle").innerHTML = compSt;

	document.getElementById("complexStyle").style.display = g_SimpleStyle ? "none" : "inline";
	document.getElementById("steps").style.display = g_SimpleStyle ? "inline" : "none";
	document.getElementById("steps").style.listStyle = g_SimpleStyle ? "inside decimal" : "none";
	document.getElementById("ingredients").style.display = g_SimpleStyle ? "inline" : "none";
	let personsString = "Personen: ";
	if (selectedRecipe.persons == undefined)
		personsString += "undefined";
	else if (typeof selectedRecipe.persons == "object")
		personsString += selectedRecipe.persons[0] + "–" + selectedRecipe.persons[1];
	else if (typeof selectedRecipe.persons == "string")
		personsString = selectedRecipe.persons;
	else
		personsString += selectedRecipe.persons;
	document.getElementById("persons").innerHTML = personsString;
}

function populateRecipeList()
{
	let list = g_Recipes.map((r,i) => {
		let url = new URL(window.location.href);
		url.searchParams.set("recipe", i);
		return '<li><a href="' + url.href + '">' + r.name + "</a></li>"
	}).join("");
	document.getElementById("recipeList").innerHTML = list;
}

function toggleFormat()
{
	g_SimpleStyle = !g_SimpleStyle;
	constructRecipe();
}

function hideId(id, hide)
{
	document.getElementById(id).style.visibility = hide ? "hidden" : "visible";
}

window.onload = function()
{
	hideId("recipePage", g_SelectedRecipeId == null);
	hideId("startPage", g_SelectedRecipeId != null);
	if (g_SelectedRecipeId != null)
	{
		constructRecipe();
		document.getElementById("toggleFormatButton").addEventListener ("click", toggleFormat, false);
	}
	else
		populateRecipeList();
}
